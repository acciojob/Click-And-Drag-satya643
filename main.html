// ==== Cube Dragging ====
const container = document.getElementById('container');
const cubes = document.querySelectorAll('.cube');

let selectedCube = null;
let offsetX = 0;
let offsetY = 0;

// Set initial positions in a 4x2 grid
cubes.forEach((cube, index) => {
  const row = Math.floor(index / 4);
  const col = index % 4;
  cube.style.left = `${col * 120}px`;
  cube.style.top = `${row * 120}px`;
});

// Mouse down - start dragging cube
cubes.forEach(cube => {
  cube.addEventListener('mousedown', e => {
    e.stopPropagation(); // prevent triggering container scroll
    selectedCube = cube;
    selectedCube.classList.add('dragging');

    const rect = selectedCube.getBoundingClientRect();
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;
  });
});

// Mouse move - drag cube
document.addEventListener('mousemove', e => {
  if (!selectedCube) return;

  const containerRect = container.getBoundingClientRect();
  const cubeRect = selectedCube.getBoundingClientRect();

  let left = e.clientX - containerRect.left - offsetX;
  let top = e.clientY - containerRect.top - offsetY;

  // Boundary constraints
  left = Math.max(0, Math.min(left, container.clientWidth - cubeRect.width));
  top = Math.max(0, Math.min(top, container.clientHeight - cubeRect.height));

  selectedCube.style.left = `${left}px`;
  selectedCube.style.top = `${top}px`;
});

// Mouse up - drop cube
document.addEventListener('mouseup', () => {
  if (selectedCube) {
    selectedCube.classList.remove('dragging');
    selectedCube = null;
  }
});

// ==== Horizontal Drag-to-Scroll for .items ====
const items = document.querySelector('.items');
let isDown = false;
let startX;
let scrollLeft;

items.addEventListener('mousedown', (e) => {
  // If we click on cube, do not trigger scroll
  if (e.target.classList.contains('cube')) return;

  isDown = true;
  items.classList.add('active');
  startX = e.pageX - items.offsetLeft;
  scrollLeft = items.scrollLeft;
});

items.addEventListener('mouseleave', () => {
  isDown = false;
  items.classList.remove('active');
});

items.addEventListener('mouseup', () => {
  isDown = false;
  items.classList.remove('active');
});

items.addEventListener('mousemove', (e) => {
  if (!isDown) return;
  e.preventDefault();
  const x = e.pageX - items.offsetLeft;
  const walk = (x - startX) * 2; // scroll-fast
  items.scrollLeft = scrollLeft - walk;
});
